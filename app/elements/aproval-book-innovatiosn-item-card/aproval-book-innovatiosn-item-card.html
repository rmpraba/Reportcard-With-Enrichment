<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="aproval-book-innovatiosn-item-card">
  <template>
    <style>
      :host {
        display: block;
      }
      table
      {
          table-layout: fixed;
          width: 1300px;
          border-collapse: collapse;
          margin-left: 26%;
          margin-top: 12%;
      }
     paper-textarea
      {
        overflow-x: hidden;
        overflow-y: visible;
        height: 90px;
        width: 70%;
        margin-top: 14%;
      }

      #dzfsd
      {
          border-radius: 10px;

          width: 250px;
          height: 320px;
          overflow-x: hidden;
          overflow-y: visible;
      }
      #dzfsd1xsasa
      {
          border-radius: 10px;
          width: 250px;
          height: 320px;
          width: 280px;
      }
      #skilldialog
      {
          border-radius: 10px;
          width: 350px;
          height: 270px;
       
      }
      #valuedialog
      {
          border-radius: 10px;
          width: 380px;
          height: 270px;
      }
      #innovationdialog
      {
          border-radius: 10px;
          width: 380px;
          height: 270px;
      }
      #remarkdialog
      {
          border-radius: 10px;
          width: 380px;
          height: 270px;
      }
    </style>
    <div>
           <paper-input value={{rowid}} hidden></paper-input>
           <paper-input value={{conceptid}} hidden></paper-input>
           <paper-input value={{capterid}} hidden></paper-input>
           <paper-input value={{rowidz}} hidden></paper-input>
        <table border="0">
           <tr style="border-bottom: 1px solid #ccc; line-height: 1.8em;border-color:#6699ff">
            <td style="padding-left: 3%;">{{rowid}}</td>
            
             <td>
                <paper-icon-button   hidden$="{{hidecheck1}}" icon="add" on-click="fngetconceptz" style="color:#6699ff;position: absolute;margin-left: 6%;margin-top: -1%;"></paper-icon-button>
                  <template is="dom-repeat" items="{{conceptzz}}" as="r">
                    <h4 style="margin-left: -11%;width: 35%;">{{r.conceptname}}</h4>
                  </template>
              </td>
             <td>
                <paper-input style="width: 60%;" value="{{period}}" allowed-pattern="[0-9]"></paper-input>
             </td>
             <td>
                <paper-input hidden$="{{hidecheck}}" value="{{planneddate}}"></paper-input>
      <div class="card"  hidden$="{{hidecheck1}}">
          <paper-input label=" planing date" class="btn" on-click="FnShowDialog" raised value="{{showdate}}"></paper-input>
           <paper-dialog id="dialog" class="paper-date-picker-dialog" modal on-iron-overlay-closed="FnDismissDialog">
          <paper-date-picker id="picker" date="{{date}}"></paper-date-picker>
         <div class="buttons">
           <paper-button dialog-dismiss>Cancel</paper-button>
           <paper-button dialog-confirm>OK</paper-button>
        </div>
        </paper-dialog>
      </div>
      <dialog-page id="ID_Show_Dialog"></dialog-page>
              </td>
             <td>
                <paper-button on-click="lsnskill">
                <h4>{{skill}}</h4>
                </paper-button>  
             </td>
             <td>
                <paper-button on-click="lsnvalue">
                  <h4>{{valuez}}</h4>
                </paper-button>
            </td>
            <td>
              <!-- <paper-textarea  readonly$="{{innovattionvaluezs}}" value="{{innovation}}"></paper-textarea> -->
              <paper-button on-click="lsninnovation">
                <h4>{{innovation}}</h4>
              </paper-button>
            </td> 
            <td>
              <!-- <paper-input value="{{remark}}"></paper-input> -->
              <paper-button on-click="lsnremark">
                <h4>{{remark}}</h4>
              </paper-button>
            </td>
              
              <td style="padding-left: 2%;">
                <paper-icon-button id="saveidd"  hidden$="{{hidecheck1}}"  icon="save" on-click="fnsavebook"></paper-icon-button>
                <paper-tooltip for="saveidd">Save</paper-tooltip>
                <paper-icon-button id="editidd" hidden$="{{hidecheck}}"  icon="create" on-click="fneditbook"></paper-icon-button> 
                <paper-tooltip for="editidd">Edit</paper-tooltip>
              </td>
             
           </tr>
       </table>
     </div>

    <paper-dialog id="dzfsd" modal>
       <h3>Concept Name</h3>
      <template is="dom-repeat" items="{{conceparr}}" as="s">
         <concept-check-card conceptid="{{s.concept_id}}" id="FFYJ{{rowid}}{{iddate}}{{s.concept_id}}" conceptname="{{s.concept}}" check="{{s.check}}" rowid="{{rowid}}"></concept-check-card>
      </template>  
      <center style="margin-top: 5%;">
          <paper-button on-click="fnsubmit"  style="background-color:black;color:white">Submit</paper-button>
         <paper-button on-click="fnclose" style="background-color:black;color:white">Close</paper-button>
      </center>
    </paper-dialog>

     <paper-dialog id="dzfsd1xsasa" modal>
       <h3>Value Name</h3>
      <template is="dom-repeat" items="{{valuearrz}}" as="ss">
         <aproval-book valueid="{{ss.value_id}}" id="VVYJ{{rowid}}{{iddate}}{{ss.value_id}}" valuename="{{ss.value_name}}" check="{{s.check}}" rowid="{{rowid}}"></aproval-book>
      </template>  
      <center style="margin-top: 5%;">
          <paper-button on-click="fnsubmit1"  style="background-color:black;color:white">Submit</paper-button>
         <paper-button on-click="fnclose1" style="background-color:black;color:white">Close</paper-button>
      </center>
    </paper-dialog>

     <paper-dialog id="skilldialog" modal>
          <paper-textarea  label="Skill" value="{{skill}}"></paper-textarea>
          <center style="margin-top: 14%;">
            <paper-button  on-click="skillsave" style="color:white;background-color:black">Save</paper-button>
            <paper-button style="color:white;background-color:black" on-click="skillclose" >Close</paper-button>
          </center>
      </paper-dialog>


     <paper-dialog id="valuedialog" modal>
          <paper-textarea label="Value" value="{{valuez}}"></paper-textarea>
          <center style="margin-top: 14%;">
            <paper-button  on-click="valuesave" style="color:white;background-color:black">Save</paper-button>
            <paper-button style="color:white;background-color:black" on-click="valueclose" >Close</paper-button>
          </center>
      </paper-dialog>

      <paper-dialog id="innovationdialog" modal>
          <paper-textarea label="Innovation"  value="{{innovation}}"></paper-textarea>
          <center style="margin-top: 14%;">
            <paper-button  on-click="innovatsave" style="color:white;background-color:black">Save</paper-button>
            <paper-button style="color:white;background-color:black" on-click="innovatclose" >Close</paper-button>
          </center>
      </paper-dialog>

      <paper-dialog id="remarkdialog" modal>
          <paper-textarea label="Remarks" value={{remark}}></paper-textarea>
          <center style="margin-top: 14%;">
            <paper-button  on-click="remarksave" style="color:white;background-color:black">Save</paper-button>
            <paper-button style="color:white;background-color:black" on-click="remarkclose" >Close</paper-button>
          </center>
      </paper-dialog>
     <iron-ajax
        method="post"
        id="fngetconceptcheckajax"
        url="{{fngetconceptcheckurl}}"
        params="{{fngetconceptcheckparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fngetconceptcheckResponse"
        debounce-duration="300" />
       </iron-ajax>
      <iron-ajax
        method="post"
        id="fngetbookvaluezajax"
        url="{{fngetbookvaluezurl}}"
        params="{{fngetbookvaluezparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fngetbookvaluezResponse"
        debounce-duration="300" />
       </iron-ajax>
     <teacher-book-service-card id="bookservice"></teacher-book-service-card>

  </template>
  <script>
  (function() {
    'use strict';
     var tempvaluarr=[];
     var conarr=[];
     var valuearr=[];
    Polymer({
      is: 'aproval-book-innovatiosn-item-card',
    ready:function()
        {
        this.remark="";
        this.innovation="";
        this.showdate=moment(new Date()).format('L');
        localStorage.setItem("localsess_last_service",this.showdate);
        },
   FnShowDialog:function(){
    this.date=new Date();
    this.$.dialog.toggle();
  },
fndates:function(e){
    this.showdate=moment(new Date()).format('L');
    localStorage.setItem("localsess_last_service",this.showdate);
  
},
  FnDismissDialog:function(e)
  { 
    if(e.detail.confirmed)
     {
      var pickdate=moment(this.$.picker.date).format('L');
      var dd1=new Date();
      var dd2=new Date(pickdate);
      var days=parseInt((dd1 - dd2) / (1000 * 60 * 60 * 24));
          if(days>0)
          {
            document.querySelector('aproval-book-innovatiosn-item-card').setdate();
          }
          else
          {
            this.showdate = moment(this.$.picker.date).format('L');
              localStorage.setItem("localsess_from_service",this.showdate);
          }      
      }
    },
    FnClear:function(){
      this.showdate = moment(new Date()).format('L');
    },
    




    fnsubmit:function(e){
     //this.$.bookservice.fnpassinsetconcept(conarr);
     this.$.dzfsd.toggle();
     var temp=[];
     for(var i=0;i<conarr.length;i++){
      if(conarr[i].rowid==this.rowid){
        temp.push({"conceptname":conarr[i].conceptname});
      }
     }
     // alert(JSON.stringify(temp));
     this.conceptzz=[];
     this.conceptzz=temp;
    },
    fnsubmit1:function(e){
     // alert(JSON.stringify(valuearr));
     this.$.dzfsd1xsasa.toggle();
     var temp1=[];
     for(var i=0;i<valuearr.length;i++){
      if(valuearr[i].rowid==this.rowid){
        temp1.push({"valuename":valuearr[i].valuename});
      }
     }
     //alert(JSON.stringify(temp1));
     this.massvalue=[];
     this.massvalue=temp1;
    },
    fnpasparr:function(e){
    conarr=e;
    // alert(JSON.stringify(conarr));
    },
    fnpasparr1:function(e){
      
    valuearr=e;
    },
    fnclose:function(e){
    this.$.dzfsd.close();
    // for(var i=0;i<conarr.length;i++){
    //   if(conarr[i].rowid==this.rowid){
        
    //   }
    //  }
    // this.emsddsad=conarr1fsdfs;
    // alert(JSON.stringify(this.emsddsad));
    },
    fnclose1:function(e){
    this.$.dzfsd1xsasa.close();
    },
    fnsavebook:function(e)
    {
      //alert(3);
      this.skillvaluezs=true;
      alert(this.innovation);
      alert(this.remark);


      if(this.period==""|| this.period==null|| this.skill=="" || this.skill==null || this.valuez=="" || this.valuez==null)
     {
          alert("Please Enter All Fields");
          this.hidecheck1=false;
        this.hidecheck=true;
           this.showdate=moment(new Date()).format('L');
        localStorage.setItem("localsess_last_service",this.showdate);
    
      }
        else if(this.planneddate=="empty" && this.innovation==""&& this.remark=="")
      {
          alert("save4");
        //alert(JSON.stringify(conarr));
        //alert(this.period+""+this.skill+""+this.innovation+""+this.remark+""+this.rowid+""+this.valuez);
        this.$.bookservice.fnsetcoskill(conarr,this.period,this.skill,this.innovation,this.remark,this.rowid,this.valuez); 
        this.hidecheck1=true;
        this.hidecheck=false;  
        this.planneddate=""; 
           this.showdate=moment(new Date()).format('L');
        localStorage.setItem("localsess_last_service",this.showdate);
        
      } 
        else if(this.planneddate=="empty" && this.remark=="")
      {
          alert("save2");
        //alert(JSON.stringify(conarr));
        //alert(this.period+""+this.skill+""+this.innovation+""+this.remark+""+this.rowid+""+this.valuez);
        this.$.bookservice.fnsetcoskill(conarr,this.period,this.skill,this.innovation,this.remark,this.rowid,this.valuez); 
        this.hidecheck1=true;
        this.hidecheck=false;  
        this.planneddate=""; 
           this.showdate=moment(new Date()).format('L');
        localStorage.setItem("localsess_last_service",this.showdate);
        
      } 
      else if(this.planneddate=="empty" && this.innovation=="")
      {
          alert("save3");
        //alert(JSON.stringify(conarr));
        //alert(this.period+""+this.skill+""+this.innovation+""+this.remark+""+this.rowid+""+this.valuez);
        this.$.bookservice.fnsetcoskill(conarr,this.period,this.skill,this.innovation,this.remark,this.rowid,this.valuez); 
        this.hidecheck1=true;
        this.hidecheck=false;  
        this.planneddate=""; 
           this.showdate=moment(new Date()).format('L');
        localStorage.setItem("localsess_last_service",this.showdate);
        
      }
        else if(this.planneddate=="empty")
      {
          alert("save1");
        //alert(JSON.stringify(conarr));
        // alert(this.period+""+this.skill+""+this.innovation+""+this.remark+""+this.rowid+""+this.valuez);
        this.$.bookservice.fnsetcoskill(conarr,this.period,this.skill,this.innovation,this.remark,this.rowid,this.valuez); 
        this.hidecheck1=true;
        this.hidecheck=false;  
        this.planneddate="";     
           this.showdate=moment(new Date()).format('L');
          localStorage.setItem("localsess_last_service",this.showdate);
    
      }

      /*else if(this.planneddate=="empty"||this.innovation==null||this.innovation=="")
      {
          alert("save3");
        //alert(JSON.stringify(conarr));
        //alert(this.period+""+this.skill+""+this.innovation+""+this.remark+""+this.rowid+""+this.valuez);
        this.$.bookservice.fnsetcoskill(conarr,this.period,this.skill,this.innovation,this.remark,this.rowid,this.valuez); 
        this.hidecheck1=true;
        this.hidecheck=false;  
        this.planneddate="";     
      }*/
      else
      {
        alert("edit");
        // alert(JSON.stringify(conarr));

        this.$.bookservice.fnbookeditskill(this.period,this.skill,this.innovation,this.remark,this.planneddate,this.rowidz,this.valuez);
      }
       /* this.hidecheck1=true;
        this.hidecheck=false; */
        
        document.querySelector('concept-check-card').fnclean();
        this.conceptjhkhzz="";

  },

    fngetconceptz:function(e){
      this.fngetconceptcheck();
      this.$.dzfsd.toggle(); 
    },
    fngetconceptz1:function(e){
       this.$.dzfsd1xsasa.toggle(); 
      this.fngetinchaptvaluevalue();
    },
    fngetinchaptvaluevalue:function(e){
    this.fngetbookvaluezurl=sessionStorage.getItem("addrinfo")+"/fngetconceptvalue111-service";
               var obj={};
               obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
               obj.academic_year=localStorage.getItem("curr_sess_academicyear");
               obj.capter_id=localStorage.getItem("curr_sess_capters");
               obj.period=this.period;
               obj.planneddate=this.planneddate;
               this.fngetbookvaluezparam=obj;
             // alert(JSON.stringify(obj));
               this.$.fngetbookvaluezajax.generateRequest();
    },
    fngetbookvaluezResponse:function(e){
      var res1=e.detail.response.skillarr;
       var res=e.detail.response.conceptarr;
       //alert(JSON.stringify(res1));
       //alert(JSON.stringify(res));
          for(var j=0;j<res.length;j++){
            var flag=0;
              for(var i=0;i<res1.length;i++){
                  
                  if(res[j].value_id==res1[i].value_id)
                  {    
                   flag=1;
                   res[j].check=true;   
                  }
                 }
                 if(flag==0){
                  res[j].check=false;
                 }
                }
                 this.valuearrz=res;
               //  alert(JSON.stringify(this.valuearrz));
},
    fngetconceptcheck:function(e)
    {
      this.fngetconceptcheckurl=sessionStorage.getItem("addrinfo")+"/fngetconceptvalue11-service";
           var obj={};
           obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
           obj.academic_year=localStorage.getItem("curr_sess_academicyear");
           obj.capter_id=localStorage.getItem("curr_sess_capters");
           obj.period=this.period;
           obj.planneddate=this.planneddate;
           this.fngetconceptcheckparam=obj;
        //  alert(JSON.stringify(obj));
           this.$.fngetconceptcheckajax.generateRequest();
          },
        fngetconceptcheckResponse:function(e){
          //alert(JSON.stringify(e.detail.response.returnval));
          var res1=e.detail.response.skillarr;
          var res=e.detail.response.conceptarr;
          for(var j=0;j<res.length;j++){
            var flag=0;
              for(var i=0;i<res1.length;i++){
                  
                  if(res[j].concept_id==res1[i].concept_id)
                  {    
                   flag=1;
                   res[j].check=true;   
                  }
                 }
                 if(flag==0){
                  res[j].check=false;
                 }
                }
      if(conarr.length>0){
        for(var i=0;i<conarr.length;i++){
          for(var j=0;j<res.length;j++){
            // res[j].check=false;
          // alert(conarr[i].conceptid+" "+res[j].concept_id+"  "+this.rowid+" "+conarr[i].rowid);
          if(conarr[i].conceptid==res[j].concept_id&&this.rowid==conarr[i].rowid){
            res[j].check=true;
          }
          }
        }
      }    
      // alert(JSON.stringify(res));      
      this.conceparr=res;
   },   
    fndelete:function(e){
    this.$.bookservice.buffdel();
    },
     fneditbook:function(e){
      this.hidecheck1=false;
      this.hidecheck=true;
      this.skillvaluezs=false;
      this.innovattionvaluezs=false;
    },
    fnsetpassvalz:function(e){
     tempvaluarr=e;
    },

    lsnskill:function(e)
    {
      this.$.skilldialog.toggle();
      //this.skillvaluezs=true;
    },
    skillsave:function(e)
    {
      this.$.skilldialog.toggle();
    },
    skillclose:function()
    {
      this.$.skilldialog.close();
      this.skill="";
    },
    lsnvalue:function(e)
    {
      this.$.valuedialog.toggle();
    },
    valuesave:function(e)
    {
      this.$.valuedialog.toggle();
      //this.skillvaluezs=true;
    },
    valueclose:function()
    {
      this.$.valuedialog.close();
      this.valuez="";
    },
    innovatsave:function(e)
    {
      this.$.innovationdialog.toggle();
      //this.innovattionvaluezs=true;
    },
    innovatclose:function()
    {
      this.$.innovationdialog.close();
      this.innovation="";
    },
    remarksave:function(e)
    {
      this.$.remarkdialog.toggle();
    },
    remarkclose:function()
    {
      this.$.remarkdialog.close();
      this.remark="";
    },
    lsninnovation:function(e)
    {
      this.$.innovationdialog.toggle();
    },

    lsnremark:function(e)
    {
      this.$.remarkdialog.toggle();
    },
    setdate:function()
    {
      alert('You are allowed to select future date only..!');
    }


   });
  })();
  </script>
</dom-module>
