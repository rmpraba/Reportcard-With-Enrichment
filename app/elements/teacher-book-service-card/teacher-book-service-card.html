<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="teacher-book-service-card">
  <template>
      <iron-ajax
        method="post"
        id="bookrefsectionajax"
        url="{{bookrefsectionurl}}"   
        params="{{bookrefsectionparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="bookrefsectionResponse"
         debounce-duration="300">
      </iron-ajax> 

      <iron-ajax
        method="post"
        id="getcaptervalueajax"
        url="{{getcaptervalueurl}}"
        params="{{getcaptervalueparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getcaptervalueResponse"
        debounce-duration="300">
        </iron-ajax>

        <iron-ajax  
        method="post"
        id="fnsetcaptureajax"
        url="{{fnsetcaptureurl}}"
        params="{{fnsetcaptureparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fnsetcaptureResponse"
        debounce-duration="300">
        </iron-ajax> 

         <iron-ajax
        method="post"
        id="conceptseqajax"
        url="{{conceptsequrl}}"
        params="{{conceptseqparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="conceptseqResponse"
        debounce-duration="300">
        </iron-ajax>

        <iron-ajax
        method="post"
        id="fngetconceptvalueajax"
        url="{{fngetconceptvalueurl}}"
        params="{{fngetconceptvalueparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fngetconceptvalueResponse"
        debounce-duration="300">
      </iron-ajax> 
      <iron-ajax
        method="post"
        id="fnsendconceptajax"
        url="{{fnsendconcepturl}}"
        params="{{fnsendconceptparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fnsendconceptResponse"
        debounce-duration="300">
        </iron-ajax>

        <iron-ajax
        method="post"
        id="deleteconceptzzzzajax"
        url="{{deleteconceptzzzzurl}}"
        params="{{deleteconceptzzzzparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="deleteconceptzzzzResponse"
        debounce-duration="300">
      </iron-ajax>

      <iron-ajax
        method="post"
        id="conceptdeletzzzzajax"
        url="{{conceptdeletzzzzurl}}"
        params="{{conceptdeletzzzzparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="conceptdeletzzzzResponse"
        debounce-duration="300">
      </iron-ajax> 

      <iron-ajax
        method="post"
        id="conceptdeletajax"
        url="{{conceptdeleturl}}"
        params="{{conceptdeletparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="conceptdeletResponse"
        debounce-duration="300">
    </iron-ajax> 
    <iron-ajax
        method="post"
        id="fnbookupdatevalueajax"
        url="{{fnbookupdatevalueurl}}"
        params="{{fnbookupdatevalueparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fnbookupdatevalueResponse"
        debounce-duration="300">
    </iron-ajax>
    <iron-ajax
        method="post"
        id="teacherbookref1ajax"
        url="{{teacherbookref1url}}"
        params="{{teacherbookref1param}}"
        handle-as="json"
        content-type="application/json"
        on-response="teacherbookref1Response"
        debounce-duration="300">
    </iron-ajax> 

    <iron-ajax
        method="post"
        id="capterseqajax"
        url="{{captersequrl}}"
        params="{{capterseqparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="capterseqResponse"
        debounce-duration="300">
    </iron-ajax>   

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'teacher-book-service-card',

      bookrefsection:function(gradeid,gradename){
           this.bookrefsectionurl=sessionStorage.getItem("addrinfo")+"/bookrefsection-service";
       var obj={"school_id":"","gradeid":"","gradename":"","academic_year":""};
      obj.gradeid=gradeid;
      obj.gradename=gradename;
      obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
      obj.academic_year=localStorage.getItem("curr_sess_academicyear"); 
      this.bookrefsectionparam=obj;
     // alert(JSON.stringify(obj))
      this.$.bookrefsectionajax.generateRequest();
      },
      bookrefsectionResponse:function(e){
     // alert(JSON.stringify(e.detail.response.subjectarr));
      //alert(JSON.stringify(e.detail.response.sectionarr));
         
      document.querySelector('teacher-book-refernce-card').subjectarr=e.detail.response.subjectarr;
        document.querySelector('teacher-book-refernce-card').sectionarr=e.detail.response.sectionarr;
        document.querySelector('teacher-book-approve-card').sectionarr=e.detail.response.sectionarr;
        document.querySelector('teacher-book-approve-card').subjectarr=e.detail.response.subjectarr;
  
  },

   getcaptervalue:function(e)
   {
     this.getcaptervalueurl=sessionStorage.getItem("addrinfo")+"/getcaptervalue-service";
     var obj={"school_id":"","academic_year":"","grade_id":"","subject_id":""};
      obj.grade_id=sessionStorage.getItem("grdeidz");
      obj.subject_id=sessionStorage.getItem("subjectidz");
      obj.section_id=sessionStorage.getItem("sectoinidz");
      obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
      obj.academic_year=localStorage.getItem("curr_sess_academicyear"); 
      this.getcaptervalueparam=obj;
     // alert(JSON.stringify(obj));
      this.$.getcaptervalueajax.generateRequest();
    
      },
      getcaptervalueResponse:function(e){
      var res=e.detail.response.returnval;
   // alert(JSON.stringify(res));
 
         var temp=[];
         var overall=[];
       //  var temp1=[];
        for(var l=0;l<res.length;l++){
        temp.push(res[l]);
         if(l!=0&&l%4==0){
            overall.push(temp);
            temp=[];
         }
        }
        overall.push(temp);

                // alert(JSON.stringify(temp));
                // alert(JSON.stringify(overall));

      document.querySelector('teacher-book-refernce-card').capterarr=overall;
      },

       fnsetcapture:function(gradeid,subjectid,captername,capterid,period,bufferperiodz){
    this.fnsetcaptureurl=sessionStorage.getItem("addrinfo")+"/bookrefsectioncapter-service";
     var obj={"school_id":"","gradeid":"","subjectid":"","academic_year":"","capter_id":"","capter":"","sectionid":""};  
      obj.gradeid=gradeid;
      obj.subjectid=subjectid;
      obj.capter_id=capterid;
      obj.capter=captername;
      obj.period=period;
      obj.buffer_period=bufferperiodz;
      obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
      obj.academic_year=localStorage.getItem("curr_sess_academicyear");
     //  alert(JSON.stringify(obj));
       this.fnsetcaptureparam=obj;
         this.$.fnsetcaptureajax.generateRequest();
    
      },

      fnsetcaptureResponse:function(e){
       var res=e.detail.response.returnval;
       alert(JSON.stringify(res));
        if(res=="Inserted"){
          this.capterseq();
          this.getcaptervalue();
      /*   document.querySelector('app-card').setPage('homepage','');
         document.querySelector('home-page').setPage('teacher-book-chapter-refernce-card','');
         this.fngetconceptvalue();
   */
         }
        
      },

       conceptseq:function()
      {     
          // alert('1');
     
        this.conceptsequrl=sessionStorage.getItem("addrinfo")+"/fetchsubjectseq-service";
        this.$.conceptseqajax.generateRequest();
      },
      
    conceptseqResponse:function(e)
      {

       var arr= e.detail.response.returnval;
       var val1=arr[0].concept_prefix+arr[0].concept_sequence;
       localStorage.setItem("curr_sess_conceptid",val1);
       
      },


      fngetconceptvalue:function()
      {
        this.fngetconceptvalueurl=sessionStorage.getItem("addrinfo")+"/fngetconceptvalue-service";
            var obj={"capter_id":""};
                obj.capter_id=localStorage.getItem("curr_sess_capters");
                this.fngetconceptvalueparam=obj;
            //  alert(JSON.stringify(obj));
             this.$.fngetconceptvalueajax.generateRequest();
      },
   fngetconceptvalueResponse:function(e)
       {            
          var res=e.detail.response.conceptarr;
          var res1=e.detail.response.chapterarr;
          /*var res2=[];
          var r=parseInt(res1[0].buffer_period)+parseInt(res1[0].period)-parseInt(res.length);
                     for(var i=0;i<res.length;i++){
                  var obj={};
                  obj.concept_id=res[i].concept_id;  
                  obj.concept=res[i].concept;   
                  obj.capter_id=res[i].capter_id;  
                  obj.period=res[i].period;  
                  obj.planned_date=res[i].planned_date;  
                  obj.hidecheck=false; 
                  obj.hidecheck1=true; 
                  res2.push(obj);     
                  }
      for(var k=0;k<r;k++){
        var obj={};
               obj.concept_id="";  
               obj.concept="";   
               obj.capter_id=""; 
               obj.hidecheck=true; 
               obj.hidecheck1=false; 
               res2.push(obj);     
              }*/



         var temp1=[];
         var overallzz=[];
        for(var l=0;l<res.length;l++)
        {
            temp1.push(res[l]);
            if(l!=0&&l%4==0)
            {
                overallzz.push(temp1);
                temp1=[];
            }
        }
        overallzz.push(temp1);


     document.querySelector('teacher-book-chapter-refernce-card').conceptarr=overallzz;

      },

       fnsendconcept:function(captheadid,conceptz){
           this.fnsendconcepturl=sessionStorage.getItem("addrinfo")+"/fnsendconcept-service";
      var obj={"capter_id":"","concept":"","concept_id":""};
      obj.capter_id=captheadid;
      obj.concept=conceptz;
      obj.concept_id=localStorage.getItem("curr_sess_conceptid");
      obj.flag='active';
     /* obj.period=period;
        obj.planned_date=localStorage.getItem("localsess_last_service");
        obj.subflag='active';
    */  
      this.fnsendconceptparam=obj;
      //alert(JSON.stringify(obj));
      this.$.fnsendconceptajax.generateRequest();
      },


      fnsendconceptResponse:function(e)
      {

         var res=e.detail.response.returnval;
          //alert(JSON.stringify(res));
            if(res=="Inserted")
            {
              alert("Inserted");
              this.conceptseq(); 
              this.fngetconceptvalue();
            }
            
      },


      deleteconcept:function(capterid)
     {
      //alert(capterid);

        this.conceptdeleturl=sessionStorage.getItem("addrinfo")+"/fnconceptdelet-service";
        var obj={"conceptid":"","capterid":""};
            obj.conceptid=localStorage.getItem("curr_sess_conceptid");
            obj.capterid=capterid;
          this.conceptdeletparam=obj;
          //alert(JSON.stringify(obj));
          this.$.conceptdeletajax.generateRequest();


      this.conceptdeletzzzzurl=sessionStorage.getItem("addrinfo")+"/fndeleteconcept2-service";
       var obj={"school_id":"","academic_year":"","grade_id":"","subject_id":"","conceptid":"","capterid":""};
        obj.grade_id=sessionStorage.getItem("grdeidz");
        obj.subject_id=sessionStorage.getItem("subjectidz");
        obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academic_year=localStorage.getItem("curr_sess_academicyear"); 
        obj.conceptid=localStorage.getItem("curr_sess_conceptid");
        obj.capterid=capterid;
        this.conceptdeletzzzzparam=obj;
       //alert(JSON.stringify(obj));
        this.$.conceptdeletzzzzajax.generateRequest();


      this.deleteconceptzzzzurl=sessionStorage.getItem("addrinfo")+"/fndeleteconceptzzzz-service";
        var obj={"school_id":"","academic_year":"","grade_id":"","subject_id":"","conceptid":"","capterid":""};
            obj.grade_id=sessionStorage.getItem("grdeidz");
            obj.subject_id=sessionStorage.getItem("subjectidz");
            obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
            obj.academic_year=localStorage.getItem("curr_sess_academicyear"); 
            obj.conceptid=localStorage.getItem("curr_sess_conceptid");
            obj.capterid=capterid;
            this.deleteconceptzzzzparam=obj;
          // alert(JSON.stringify(obj));
            this.$.deleteconceptzzzzajax.generateRequest();

     },

     deleteconceptzzzzResponse:function(e)
     {
        var res=e.detail.response.returnval;
       // alert(JSON.stringify(res));
     },

     conceptdeletzzzzResponse:function(e)
     {
        var res=e.detail.response.returnval;
        //alert(JSON.stringify(res));
     },
     conceptdeletResponse:function(e)
     {
         var res=e.detail.response.returnval;
        //alert(JSON.stringify(res));
     },

     fnbookupdatevalue:function(capterid,concept,period,planneddate)
      {
           this.fnbookupdatevalueurl=sessionStorage.getItem("addrinfo")+"/fnbookupdatevalue-service";
       var obj={"capter_id":"","concept":"","concept_id":""};
      obj.capter_id=localStorage.getItem("curr_sess_capters");
      obj.concept=concept;
      obj.period=period;
      obj.concept_id=capterid;
      obj.planned_date=planneddate;
      obj.subflag='active';
      this.fnbookupdatevalueparam=obj;
    //  alert(JSON.stringify(obj));
      this.$.fnbookupdatevalueajax.generateRequest();
      },
      fnbookupdatevalueResponse:function(e){
           var res=e.detail.response.returnval;
          //alert(JSON.stringify(res));
          alert('Updated');
     },



      teacherbookref1:function(e)
      {
          this.teacherbookref1url=sessionStorage.getItem("addrinfo")+"/fnschoolgradeset-service";
          // alert(JSON.stringify(obj));
           this.$.teacherbookref1ajax.generateRequest();
      },
      teacherbookref1Response:function(e)
      {
          var res=e.detail.response.returnval;
          document.querySelector('teacher-book-refernce-card').empschoolnamesarr=res;
      },

       capterseq:function()
      {     
          // alert('1');
     
        this.captersequrl=sessionStorage.getItem("addrinfo")+"/fetchsubjectseq-service";
        this.$.capterseqajax.generateRequest();
      },

      capterseqResponse:function(e)
      {

       var arr= e.detail.response.returnval;
         //alert(JSON.stringify(arr));
          //   alert(JSON.stringify(arr[0].chapter_prefix+arr[0].chapter_sequence));
      
       document.querySelector('teacher-book-refernce-card').capterid=arr[0].chapter_prefix+arr[0].chapter_sequence;
       
      },

    });
  })();
  </script>
</dom-module>
